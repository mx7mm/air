#!/bin/sh
# Air Init Script
# This runs as PID 1

# Mount essential filesystems
mount -t proc proc /proc
mount -t sysfs sysfs /sys
mount -t devtmpfs devtmpfs /dev

# Mount tmpfs for writable directories (read-only root)
mount -t tmpfs tmpfs /tmp
mount -t tmpfs tmpfs /run
mkdir -p /run/lock

# Mount /var as tmpfs and restore directory structure
mount -t tmpfs tmpfs /var
mkdir -p /var/log /var/tmp /var/cache /var/lib /var/lock /var/spool

# Set hostname
hostname air

# Quiet down console output
if [ -w /proc/sys/kernel/printk ]; then
	echo 0 > /proc/sys/kernel/printk
fi

# Start the session; reboot if it exits
if [ -x /usr/bin/air-session ]; then
	/usr/bin/air-session
else
	echo "air-session not found"
fi

/sbin/reboot -f
